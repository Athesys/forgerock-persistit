
// Runs the StressRecovery test to perform a lot of transactions
// This phase is intended to be stopped by kill -9 or power stop.
// It emits a verbose stream of "tickets" for committed transactions.
// Running the recovery_2.plan script verifies that the transactions
// are present.
//
// To run this:
// 
//    java -cp ${PERSISTIT_JAR} com.persistit.test.TestRunner 
//              script=recovery_1.plan datapath=/tmp/persistit_test_data -e
//
// The -e flag causes TestRunner to exit with a non-zero status on failure.

delete $datapath$/persistit.v01 $datapath$/persistit_journal.*

prop buffer.count.8192=50000
prop volume.1=$datapath$/persistit.v01,create,bufferSize:8192,initialSize:100M,extensionSize:100M,maximumSize:100G,alias:persistit
prop journalpath=$datapath$/persistit_journal
prop logpath=$datapath$/persistit_log
prop rmiport=8081

//
// These threads won't terminate. Operator should kill the JVM or pull the plug
init

# Recovery_1 - Run transactions until crash
multithread
test com.persistit.stress.StressRecovery
test com.persistit.stress.StressRecovery
test com.persistit.stress.StressRecovery
test com.persistit.stress.StressRecovery
test com.persistit.stress.StressRecovery

icheck persistit

close